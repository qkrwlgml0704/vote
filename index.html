<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>누구 뽑지?</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">
  <link rel="shortcut icon" type="image⁄x-icon" href="./img/vote.png">
  <link href="https://fonts.googleapis.com/css?family=Do+Hyeon" rel="stylesheet">
  <link rel="stylesheet" href="./css/moblie.css">
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script>

    $(function () {
      $('.banner1 ul li a').click(function (e) {
        e.preventDefault();
        var tg = $(this).attr('href');
        $('.content > div').stop().hide();
        $(tg).stop().show();
      });
    });

    $(function () {
      $('.banner2 ul li a').click(function (e) {
        e.preventDefault();
        var tg = $(this).attr('href');
        $('.content > div').stop().hide();
        $(tg).stop().show();
      });
    });

    $(function () {
      $('.banner1 ul li').click(function () {
        $('li').removeClass('on');
        $(this).addClass('on');
      });
    });

    $(function () {
      $('.banner2 ul li').click(function () {
        $('li').removeClass('on');
        $(this).addClass('on');
      });
    });

    $(function () {
      $('.select ul li a').click(function (e) {
        e.preventDefault();
        var tg = $(this).attr('href');
        $('.choice').stop().fadeOut();
        $(tg).stop().fadeIn();
      });
    });

    $(function () {
      $('.select li').click(function () {
        $('.select li').removeClass('mo');
        $(this).addClass('mo');
      });
    });
  </script>
</head>

<body>
  <div class="select">
    <ul>
      <li class="mo"><a href="#pc"><img src="./img/pc.png" alt=""></a></li>
      <li><a href="#phone"><img src="./img/phone.png" alt=""></a></li>
    </ul>
  </div>
  <div id="pc" class="choice">
    <div class="logo">
      <p>누구 뽑지?</p>
    </div>
    <div class="banner1">
      <ul class="menu">
        <li class="on"><a href="#con11">후보자</a></li>
        <li><a href="#con12">투표소</a></li>
        <li><a href="#con13">개표결과</a></li>
        <li><a href="#con14">당선인</a></li>
      </ul>
    </div>
    <div class="content">
      <div id="con11">
        <img src="./img/i1.png" alt="">
        <p class="title">우리동네 후보자 찾아보기</p>
        <form onsubmit="return false;" class="form-inline">
          <select name="sgCode" class="sgCode">
            <option value="">선거명 선택</option>
          </select>
          <select name="sdName" class="sdName">
            <option value="">지역 선택</option>
          </select>
          <select name="sggName" class="sggName">
            <option value="">시군구 선택</option>
          </select>
          <button onclick="getCandidate(this.form);">확인</button>
        </form>
      </div>
      <div id="con12">
        <img src="./img/i2.png" alt="">
        <p class="title">우리동네 투표소 찾아보기</p>
        <form onsubmit="return false;" class="form-inline">
          <select name="sdName" class="sdName">
            <option value="">지역 선택</option>
          </select>
          <select name="sggName" class="sggName">
            <option value="">시군구 선택</option>
          </select>
          <button onclick="getPolling(this.form);">확인</button>
        </form>
      </div>
      <div id="con13">
        <img src="./img/i3.png" alt="">
        <p class="title">개표 결과 알아보기</p>
        <form onsubmit="return false;" class="form-inline">
          <select name="sgCode" class="sgCode">
            <option value="">선거명 선택</option>
          </select>
          <select name="sdName" class="sdName">
            <option value="">지역 선택</option>
          </select>
          <button onclick="getResult(this.form);">확인</button>
        </form>
      </div>
      <div id="con14">
        <img src="./img/i4.png" alt="">
        <p class="title">당선인 정보 알아보기</p>
        <form onsubmit="return false;" class="form-inline">
          <select name="sgCode" class="sgCode">
            <option value="">선거명 선택</option>
          </select>
          <select name="sdName" class="sdName">
            <option value="">지역 선택</option>
          </select>
          <button onclick="getElection(this.form);">확인</button>
        </form>
      </div>
      <div class="view">
        <p></p>
        <ul class="vote"></ul>
        <table class="table table-hover">
          <thead></thead>
          <tbody></tbody>
        </table>
        <ul class="ele"></ul>
      </div>
    </div>
  </div>
  <!-------------------------------------------------------------------------------------------------->

  <!----------------------------------------------- pc ----------------------------------------------->

  <!-------------------------------------------------------------------------------------------------->
  <div id="phone" class="choice">
    <div class="posi">
      <div class="phone-img" style="position: absolute">
        <img src="./img/phone-view.png" alt="" style="position: relative">
      </div>
      <div class="rab" style="position:absolute">
        <div class="logo">
          <p>누구 뽑지?</p>
        </div>
        <div class="banner2">
          <ul class="menu">
            <li class="on"><a href="#con21">후보자</a></li>
            <li><a href="#con22">투표소</a></li>
            <li><a href="#con23">개표결과</a></li>
            <li><a href="#con24">당선인</a></li>
          </ul>
        </div>
        <div class="content">
          <div id="con21">
            <img src="./img/i1.png" alt="">
            <p class="title">우리동네 후보자 찾아보기</p>
            <form onsubmit="return false;" class="form-inline">
              <select name="sgCode" class="sgCode">
                <option value="">선거명 선택</option>
              </select>
              <select name="sdName" class="sdName">
                <option value="">지역 선택</option>
              </select>
              <select name="sggName" class="sggName">
                <option value="">시군구 선택</option>
              </select>
              <button onclick="getCandidate(this.form);">확인</button>
            </form>
          </div>
          <div id="con22">
            <img src="./img/i2.png" alt="">
            <p class="title">우리동네 투표소 찾아보기</p>
            <form onsubmit="return false;" class="form-inline">
              <select name="sdName" class="sdName">
                <option value="">지역 선택</option>
              </select>
              <select name="sggName" class="sggName">
                <option value="">시군구 선택</option>
              </select>
              <button onclick="getPolling(this.form);">확인</button>
            </form>
          </div>
          <div id="con23">
            <img src="./img/i3.png" alt="">
            <p class="title">개표 결과 알아보기</p>
            <form onsubmit="return false;" class="form-inline">
              <select name="sgCode" class="sgCode">
                <option value="">선거명 선택</option>
              </select>
              <select name="sdName" class="sdName">
                <option value="">지역 선택</option>
              </select>
              <button onclick="getResult(this.form);">확인</button>
            </form>
          </div>
          <div id="con24">
            <img src="./img/i4.png" alt="">
            <p class="title">당선인 정보 알아보기</p>
            <form onsubmit="return false;" class="form-inline">
              <select name="sgCode" class="sgCode">
                <option value="">선거명 선택</option>
              </select>
              <select name="sdName" class="sdName">
                <option value="">지역 선택</option>
              </select>
              <button onclick="getElection(this.form);">확인</button>
            </form>
          </div>
          <div class="view">
            <p></p>
            <ul class="vote"></ul>
            <table class="table table-hover">
              <thead></thead>
              <tbody></tbody>
            </table>
            <ul class="ele"></ul>
          </div>
        </div>
      </div>
    </div>
</body>
<script>

  var key = "7eD5be%2Fby%2FPLL5EeqoTnJ8j3G%2FZQMxo5gzGl5h0r63ed2YgArMVYY%2BBi0Na4LYHcDCXhULdEO2%2F8vFInRJT3Mw%3D%3D";
  $(".view").hide();

  /* 후보자 정보 조회 */
  function getCandidate(f) {
    var sgCode = f.sgCode.value;
    var sdName = f.sdName.value;
    var sggName = f.sggName.value;

    if (sgCode == "") {
      alert("선거명을 선택해주세요");
      return;
    }

    if (sdName == "") {
      alert("지역을 선택해주세요");
      return;
    }

    $(".view ul li").remove();

    var url = 'http://apis.data.go.kr/9760000/PofelcddInfoInqireService/getPofelcddRegistSttusInfoInqire'; /*URL*/
    url += '?' + encodeURIComponent('ServiceKey') + '=' + key; /*Service Key*/
    url += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent(key); /*공공데이터포털에서 받은 인증키*/
    url += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('100'); /*한 페이지 결과 수*/
    url += '&' + encodeURIComponent('sgId') + '=' + encodeURIComponent('20180613'); /*선거ID*/
    url += '&' + encodeURIComponent('sgTypecode') + '=' + encodeURIComponent(sgCode); /*선거종류코드*/
    url += '&' + encodeURIComponent('sdName') + '=' + encodeURIComponent(sdName); /*선거종류코드*/
    url += '&' + encodeURIComponent('sggName') + '=' + encodeURIComponent(sggName); /*선거종류코드*/

    console.log("url : " + url)
    $.get(url, function (res) {
      var items = $(res).find("item");
      console.log(res);
      if (items.length == 0) {
        alert("검색 결과가 없습니다");
      }
      for (let i = 0; i < items.length; i++) {
        var name = $(items[i]).find("name").text();
        var jdName = $(items[i]).find("jdName").text();
        var giho = $(items[i]).find("giho").text();
        var list = "<li>" +
          "<p>" + name + "</p>" +
          "<p>" + jdName + "</p>" +
          "<p>" + giho + "번</p>" +
          "</li>"
        $(".view ul").append(list);
      }
    });
  }

  /* 투표소 정보 조회 */
  function getPolling(f) {
    var sdName = f.sdName.value;
    var sggName = f.sggName.value;
    if (sdName == "") {
      alert("지역을 선택해주세요");
      return;
    }
    if (sggName == "") {
      alert("시군구를 선택해주세요");
      return;
    }

    $(".view p").empty();
    $(".view ul li").remove();
    $(".view table").remove();
    $(".content #con12").hide();
    $(".content #con22").hide();
    $(".view").show();

    var title = sdName + " " + sggName + " 투표소 정보";
    $(".view p").append(title);

    var url = "http://apis.data.go.kr/9760000/PolplcInfoInqireService2/getPolplcOtlnmapTrnsportInfoInqire";
    url += '?' + encodeURIComponent('ServiceKey') + '=' + key; /*Service Key*/
    url += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent(key); /*공공데이터포털에서 받은 인증키*/
    url += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('100'); /*한 페이지 결과 수*/
    url += '&' + encodeURIComponent('sgId') + '=' + encodeURIComponent('20180613'); /*선거ID*/
    url += '&' + encodeURIComponent('sdName') + '=' + encodeURIComponent(sdName); /*선거종류코드*/
    url += '&' + encodeURIComponent('wiwName') + '=' + encodeURIComponent(sggName); /*선거종류코드*/

    $.get(url, function (res) {
      var items = $(res).find("item");
      console.log(res);
      for (let i = 0; i < items.length; i++) {
        var sdName = $(items[i]).find("sdName").text();
        var wiwName = $(items[i]).find("wiwName").text();
        var emdName = $(items[i]).find("emdName").text();
        var placeName = $(items[i]).find("placeName").text();
        var addr = $(items[i]).find("addr").text();
        var list = "<li>" + sdName + " " + wiwName + " " + emdName + " " + placeName + "</li>"
        $(".view .vote").append(list);
      }
    });
  }

  /* 개표 결과 조회 */
  function getResult(f) {
    var sgCode = f.sgCode.value;
    var sdName = f.sdName.value;

    if (sgCode == "") {
      alert("선거명을 선택해주세요");
      return;
    }
    if (sdName == "") {
      alert("지역을 선택해주세요");
      return;
    }
    
    $(".view p").empty();
    $(".view ul li").remove();
    $(".content #con13").hide();
    $(".content #con23").hide();
    $(".view").show();

    var url = 'http://apis.data.go.kr/9760000/VoteXmntckInfoInqireService2/getXmntckSttusInfoInqire'; /*URL*/
    url += '?' + encodeURIComponent('ServiceKey') + '=' + key; /*Service Key*/
    url += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent(key); /*공공데이터포털에서 받은 인증키*/
    url += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('100'); /*한 페이지 결과 수*/
    url += '&' + encodeURIComponent('sgId') + '=' + encodeURIComponent('20180613'); /*선거ID*/
    url += '&' + encodeURIComponent('sgTypecode') + '=' + encodeURIComponent(sgCode); /*선거종류*/
    url += '&' + encodeURIComponent('sdName') + '=' + encodeURIComponent(sdName); /*시도명*/

    $.get(url, function (res) {
      var items = $(res).find("item");
      console.log(res);
      if (items.length == 0) {
        alert("검색 결과가 없습니다");
        return;
      }
      for (let i = 0; i < 1; i++) {
        var jd01 = $(items[i]).find("jd01").text(); /*정당1*/
        var jd02 = $(items[i]).find("jd02").text(); /*정당2*/
        var jd03 = $(items[i]).find("jd03").text(); /*정당3*/
        var hbj01 = $(items[i]).find("hbj01").text(); /*사람1*/
        var hbj02 = $(items[i]).find("hbj02").text(); /*사람2*/
        var hbj03 = $(items[i]).find("hbj03").text(); /*사람3*/
        var dugsu01 = $(items[i]).find("dugsu01").text(); /*투표1*/
        var dugsu02 = $(items[i]).find("dugsu02").text(); /*투표2*/
        var dugsu03 = $(items[i]).find("dugsu03").text(); /*투표3*/
        var a = parseInt(dugsu01);
        var b = parseInt(dugsu02);
        var c = parseInt(dugsu03);
        var max = Math.max(a,b,c);
        var img = "<img src='./img/crown.png'>";
        var sum = a + b + c;
        if (jd02 == "" && dugsu02 == "") {
          jd02 = "";
          dugsu02 = "";
        }
        if (jd03 == "" && dugsu02 == "") {
          jd03 = "";
          dugsu02 = "";
        }
        var title = "<p>" + sdName + " 개표 정보" + "</p>"
        var hlist = "<tr><th scope='col'>#</th><th scope='col'>후보자</th><th scope='col'>득표수</th><th scope='col'>당선</th></tr>";
        var blist = "<tr><th scope='row'>1</th><td>" + hbj01 + " ("+ jd01 +")</td><td>" + dugsu01 + "</td><td>"+ img +"</td></tr>";
            blist += "<tr><th scope='row'>2</th><td>" + hbj02 + " ("+ jd02 +")</td><td>" + dugsu02 + "</td><td></td></tr>";
            blist += "<tr><th scope='row'>3</th><td>" + hbj03 + " ("+ jd03 +")</td><td>" + dugsu03 + "</td><td></td></tr>";
            blist += "<tr><th scope='row'></th><td>합계</td><td>"+ sum +"</td><td></td></tr>";
        $(".view p").append(title);
        $(".view .table thead").append(hlist);
        $(".view .table tbody").append(blist);
      }
    });
  }


   /* 당선인 정보 조회 */
   function getElection(f) {

    var sgCode = f.sgCode.value;
    var sdName = f.sdName.value;

    if (sgCode == "") {
      alert("선거명을 선택해주세요");
      return;
    }
    if (sdName == "") {
      alert("지역을 선택해주세요");
      return;
    }

    $(".view p").empty();
    $(".view ul li").remove();
    $(".view table").remove();
    $(".content #con14").hide();
    $(".content #con24").hide();
    $(".view").show();

    var title = sdName + " 당선 정보";
    $(".view p").append(title);

    var url = "http://apis.data.go.kr/9760000/WinnerInfoInqireService2/getWinnerInfoInqire";
    url += '?' + encodeURIComponent('ServiceKey') + '=' + key; /*Service Key*/
    url += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent(key); /*공공데이터포털에서 받은 인증키*/
    url += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('100'); /*한 페이지 결과 수*/
    url += '&' + encodeURIComponent('sgId') + '=' + encodeURIComponent('20180613'); /*선거ID*/
    url += '&' + encodeURIComponent('sgTypecode') + '=' + encodeURIComponent(sgCode); /*선거ID*/
    url += '&' + encodeURIComponent('sdName') + '=' + encodeURIComponent(sdName); /*선거종류코드*/

    $.get(url, function (res) {
      var items = $(res).find("item");
      console.log(res);
      if (items.length == 0) {
        console.log("검색 결과가 없습니다");
      }
      for (let i = 0; i < items.length; i++) {
        var name = $(items[i]).find("name").text();
        var hanja = $(items[i]).find("hanjaname").text();
        var jdName = $(items[i]).find("jdName").text();
        var jdimg;
        if(jdName == '' || jdName == '무소속'){
          jdimg = "./img/mu.png";
        }
        if(jdName == '더불어민주당'){
          jdimg = "./img/d.png";
        }
        if(jdName == '자유한국당'){
          jdimg = "./img/j.png";
        }
        if(jdName == '정의당'){
          jdimg = "./img/jd.png";
        }
        if(jdName == '민중당'){
          jdimg = "./img/m.png";
        }
        if(jdName == '민주평화당'){
          jdimg = "./img/min.png";
        }
        var gender = $(items[i]).find("gender").text();
        var birthday = $(items[i]).find("birthday").text();
        var job = $(items[i]).find("job").text();
        var edu = $(items[i]).find("edu").text();
        var career1 = $(items[i]).find("career1").text(); 
        var list = "<li><span>" + name + "(" + gender + ")"+"</span><img src='"+ jdimg +"'></li>";
        console.log(list);
        $(".view .ele").append(list);
      }
    });
  }

  /* 공통 - 선거명 조회 */
  function getSgcode() {
    var url = 'http://apis.data.go.kr/9760000/CommonCodeService/getCommonSgCodeList'; /*URL*/
    url += '?' + encodeURIComponent('ServiceKey') + '=' + key; /*Service Key*/
    url += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent(key); /*공공데이터포털에서 받은 인증키*/

    $.get(url, function (res) {
      var items = $(res).find("item");
      for (let i = 1; i < items.length; i++) {
        var sgName = $(items[i]).find("sgName").text();
        var sgTypecode = $(items[i]).find("sgTypecode").text();
        var option = "<option value='" + sgTypecode + "'>" + sgName + "</option>"
        $(".sgCode").append(option);
      }
    });
  }
  getSgcode();

  /* 공통 - 지역 조회 */
  function getSdname() {
    var url = "http://apis.data.go.kr/9760000/CommonCodeService/getCommonSggCodeList";
    url += '?' + encodeURIComponent('ServiceKey') + '=' + key; /*Service Key*/
    url += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent(key); /*공공데이터포털에서 받은 인증키*/
    url += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30'); /*한 페이지 결과 수*/
    url += '&' + encodeURIComponent('sgId') + '=' + encodeURIComponent('20180613'); /*선거ID*/
    url += '&' + encodeURIComponent('sgTypecode') + '=' + encodeURIComponent('11'); /*선거종류코드*/

    $.get(url, function (res) {
      var items = $(res).find("item");
      for (let i = 0; i < items.length; i++) {
        var sdName = $(items[i]).find("sdName").text();
        var sggName = $(items[i]).find("sggName").text();
        var option = "<option value='" + sggName + "'>" + sdName + "</option>"
        $(".sdName").append(option);
      }
    });
  }
  getSdname();

  /* 공통 - 시군구 조회 */
  function getGusigun(sdName) {
    var gusigun = gusigun ? gusigun : "";
    var url = 'http://apis.data.go.kr/9760000/CommonCodeService/getCommonGusigunCodeList'; /*URL*/
    url += '?' + encodeURIComponent('ServiceKey') + '=' + key; /*Service Key*/
    url += '&' + encodeURIComponent('ServiceKey') + '=' + encodeURIComponent(key); /*공공데이터포털에서 받은 인증키*/
    url += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30'); /*한 페이지 결과 수*/
    url += '&' + encodeURIComponent('sgId') + '=' + encodeURIComponent('20180613'); /*선거ID*/
    url += '&' + encodeURIComponent('sdName') + '=' + encodeURIComponent(sdName); /*선거종류코드*/

    $.get(url, function (res) {
      var items = $(res).find("item");
      for (let i = 1; i < items.length; i++) {
        var wiwName = $(items[i]).find("wiwName").text();
        var option = "<option value='" + wiwName + "'>" + wiwName + "</option>"
        $(".sggName").append(option);
      }
    });
  }

  /* 공통 - 지역이 바뀌었을 때 조회 */
  $('.sdName').change(function () {
    var sdName = $(this).val();
    $(".sggName option").remove();
    $(".sggName").append("<option value=''>시군구 선택</option>");
    getGusigun(sdName);
  });
  
</script>

</html>